<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>瞬間英作文 Drill — JP→EN / Image→EN</title>
<style>
  body {
    margin: 0;
    background: linear-gradient(180deg, #0b0c10, #0e1117);
    color: #eaf1ff;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", Helvetica, Arial;
  }
  .wrap {
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
  }
  .card {
    background: #141821;
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0, 0, 0, .4);
    padding: 20px;
  }
  .jp { font-size: 22px; margin-bottom: 10px; }
  .en { font-size: 20px; color: #bbf1ff; }
  .muted { color: #9fb0c8; font-size: 14px; }
  .audioBtn {
    background: linear-gradient(90deg, #4da3ff, #22c55e);
    border: none;
    border-radius: 10px;
    color: #021019;
    padding: 10px 14px;
    font-weight: 600;
    cursor: pointer;
  }
  select, input[type="range"] {
    background: #1a2130;
    color: #eaf1ff;
    border-radius: 8px;
    border: 1px solid #2b3648;
  }
</style>
</head>
<body>
  <div class="wrap">
    <h2>⚡ 瞬間英作文 Drill（GitHub Pages版・音声自動）</h2>

    <div class="card">
      <div id="jpText" class="jp"></div>
      <div id="enText" class="en" style="display:none"></div>
      <div style="margin-top:12px">
        <button id="revealBtn" class="audioBtn">解答を表示</button>
        <button id="nextBtn" class="audioBtn">次のカード ▶</button>
      </div>
      <hr style="margin:20px 0;border:1px solid #1e2635">
      <button id="playAudio" class="audioBtn">▶ 再生（英語TTS）</button>
      <label style="margin-left:8px">Voice:
        <select id="voiceSelect"><option value="">default</option></select>
      </label>
      <label style="margin-left:8px">Rate:
        <input id="rate" type="range" min="0.8" max="1.4" step="0.1" value="1">
      </label>
    </div>

    <p class="muted" style="margin-top:12px">ブラウザ内TTSを使用。音声ファイル不要・完全ローカル動作。</p>
  </div>

<script>
let cards = [];
let cur = 0;
const jpText = document.getElementById('jpText');
const enText = document.getElementById('enText');
const nextBtn = document.getElementById('nextBtn');
const revealBtn = document.getElementById('revealBtn');
const playAudioBtn = document.getElementById('playAudio');
const voiceSelect = document.getElementById('voiceSelect');
const rateInput = document.getElementById('rate');

let voices = [];
function loadVoices(){
  voices = speechSynthesis.getVoices().filter(v => v.lang.startsWith('en'));
  voiceSelect.innerHTML = '<option value=\"\">default</option>';
  voices.forEach((v,i)=>{
    const opt=document.createElement('option');
    opt.value=i;
    opt.textContent=v.name+' — '+v.lang;
    voiceSelect.appendChild(opt);
  });
}
speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();

function speak(text){
  if(!('speechSynthesis' in window)) return alert('SpeechSynthesis未対応ブラウザです');
  const u = new SpeechSynthesisUtterance(text);
  const sel = voiceSelect.value;
  if(sel!==''){ u.voice = voices[parseInt(sel)]; u.lang=u.voice.lang; }
  u.rate = parseFloat(rateInput.value);
  speechSynthesis.speak(u);
}

async function loadCards(){
  const res = await fetch('cards.json');
  cards = await res.json();
  showCard();
}

function showCard(){
  if(cards.length===0) return;
  const c = cards[cur];
  jpText.textContent = c.JP;
  enText.textContent = c.ModelEN;
  enText.style.display='none';
}

revealBtn.onclick = ()=> enText.style.display='block';
nextBtn.onclick = ()=>{
  cur = (cur+1) % cards.length;
  showCard();
};
playAudioBtn.onclick = ()=>{
  const c = cards[cur];
  speak(c.ModelEN);
};

loadCards();
</script>
</body>
</html>
