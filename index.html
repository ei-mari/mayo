<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>🌷 瞬間英作文カード</title>
<style>
  :root {
    --accent:#ff7ca8;
    --border:#f2f2f2;
    --shadow:0 8px 20px rgba(0,0,0,.05);
    --font: "Noto Sans JP", "Helvetica Neue", sans-serif;
  }
  body {
    margin:0;
    font-family:var(--font);
    background:#fafafa;
    color:#333;
    line-height:1.6;
  }
  h1 {
    text-align:center;
    font-weight:600;
    font-size:1.4rem;
    margin:30px 0 20px;
    color:#ff7ca8;
  }
  .wrap {
    max-width:600px;
    margin:0 auto;
    padding:20px;
  }
  .card {
    background:#fff;
    border:1px solid var(--border);
    border-radius:14px;
    box-shadow:var(--shadow);
    padding:25px 20px;
    text-align:center;
    transition:.3s;
  }
  .card:hover { transform:translateY(-2px); }
  .jp {
    font-size:20px;
    color:#555;
    margin-bottom:12px;
  }
  .divider {
    height:1px;
    background:#f0f0f0;
    margin:16px 0;
  }
  .en {
    font-size:20px;
    color:#444;
    display:none;
  }
  button {
    font-family:var(--font);
    border:none;
    border-radius:25px;
    padding:10px 18px;
    margin:6px 4px;
    cursor:pointer;
    transition:all .2s ease;
  }
  .btn-main {
    background:var(--accent);
    color:#fff;
    font-weight:600;
  }
  .btn-main:hover { background:#ff6198; }
  .btn-sub {
    background:#f3f3f3;
    color:#555;
  }
  .btn-sub:hover { background:#e9e9e9; }
  select, input[type="range"] {
    margin:6px;
    border-radius:8px;
    border:1px solid #ddd;
    padding:4px;
  }
  footer {
    text-align:center;
    font-size:13px;
    color:#999;
    margin-top:30px;
  }
</style>
</head>
<body>
  <h1>🌷 瞬間英作文カード</h1>

  <div class="wrap">
    <div class="card">
      <div id="jpText" class="jp"></div>
      <div class="divider"></div>
      <div id="enText" class="en"></div>

      <div style="margin-top:20px">
        <button id="revealBtn" class="btn-main">解答を表示</button>
        <button id="nextBtn" class="btn-sub">次のカード ▶</button>
      </div>

      <div class="divider"></div>
      <div>
        <button id="playAudio" class="btn-main">▶ 再生（英語TTS）</button>
        <br>
        <label>Voice:
          <select id="voiceSelect"><option value="">default</option></select>
        </label>
        <label>Rate:
          <input id="rate" type="range" min="0.8" max="1.4" step="0.1" value="1">
        </label>
      </div>
    </div>
    <footer>✨ Made with love — EIMARI ✨</footer>
  </div>

<script>
let cards = [];
let cur = 0;
const jpText = document.getElementById('jpText');
const enText = document.getElementById('enText');
const nextBtn = document.getElementById('nextBtn');
const revealBtn = document.getElementById('revealBtn');
const playAudioBtn = document.getElementById('playAudio');
const voiceSelect = document.getElementById('voiceSelect');
const rateInput = document.getElementById('rate');

let voices = [];
function loadVoices(){
  voices = speechSynthesis.getVoices().filter(v => v.lang.startsWith('en'));
  voiceSelect.innerHTML = '<option value=\"\">default</option>';
  voices.forEach((v,i)=>{
    const opt=document.createElement('option');
    opt.value=i;
    opt.textContent=v.name+' — '+v.lang;
    voiceSelect.appendChild(opt);
  });
}
speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();

function speak(text){
  if(!('speechSynthesis' in window)) return alert('SpeechSynthesis未対応ブラウザです');
  const u = new SpeechSynthesisUtterance(text);
  const sel = voiceSelect.value;
  if(sel!==''){ u.voice = voices[parseInt(sel)]; u.lang=u.voice.lang; }
  u.rate = parseFloat(rateInput.value);
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

async function loadCards(){
  const res = await fetch('cards.json');
  cards = await res.json();
  showCard();
}

function showCard(){
  if(cards.length===0) return;
  const c = cards[cur];
  jpText.textContent = c.JP;
  enText.textContent = c.ModelEN;
  enText.style.display='none';
}

revealBtn.onclick = ()=> enText.style.display='block';
nextBtn.onclick = ()=>{
  cur = (cur+1) % cards.length;
  showCard();
};
playAudioBtn.onclick = ()=>{
  const c = cards[cur];
  speak(c.ModelEN);
};

loadCards();
</script>
</body>
</html>
