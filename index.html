<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸŒ· ç¬é–“è‹±ä½œæ–‡ã‚«ãƒ¼ãƒ‰</title>
<style>
  :root {
    --accent: #ff7ca8;
    --bg: #f8f8f8;
    --surface: #fff;
    --shadow: 0 4px 12px rgba(0,0,0,0.08);
    --shadow-hover: 0 8px 20px rgba(0,0,0,0.15);
    --text: #333;
    --muted: #777;
  }
  body {
    margin:0;
    font-family:"Noto Sans JP","Helvetica Neue",sans-serif;
    background:var(--bg);
    color:var(--text);
    display:flex;
    flex-direction:column;
    align-items:center;
    min-height:100vh;
    padding:20px;
  }
  h1 {
    font-weight:600;
    font-size:1.4rem;
    color:var(--accent);
    margin:10px 0 20px;
  }

  .card-container {
    width: 100%;
    max-width: 420px;
    perspective: 1000px;
  }
  .card {
    width: 100%;
    border-radius: 18px;
    box-shadow: var(--shadow);
    transition: transform 0.6s;
    transform-style: preserve-3d;
    cursor: pointer;
    position: relative;
    background: var(--surface);
  }
  .card.flip { transform: rotateY(180deg); }

  .card-face {
    border-radius: 18px;
    padding: 28px 20px;
    text-align: center;
    min-height: 320px;
    backface-visibility: hidden;
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    align-items:center;
    position: absolute;
    width: 100%;
    top: 0;
    left: 0;
  }
  .card-face.back {
    transform: rotateY(180deg);
  }

  .jp, .en {
    font-size: 20px;
    color: var(--text);
    font-weight:500;
    margin-top:20px;
  }
  .en { font-size: 22px; color:#444; }

  .controls {
    margin-top: 20px;
    width:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:10px;
  }

  button, select {
    border:none;
    border-radius:25px;
    padding:10px 18px;
    font-size:15px;
    cursor:pointer;
    transition:.2s ease;
  }
  .btn-main { background:var(--accent); color:#fff; }
  .btn-main:hover { background:#ff6198; }
  .btn-sub { background:#f0f0f0; color:#444; }
  .btn-sub:hover { background:#e4e4e4; }

  select {
    padding:8px 14px;
    border-radius:20px;
    border:1px solid #ddd;
    background:#fff;
    color:#333;
  }

  .progress {
    margin-top: 15px;
    text-align:center;
    color:#999;
    font-size:14px;
  }
  footer {
    margin-top:25px;
    color: var(--muted);
    font-size:13px;
  }
</style>
</head>
<body>
  <h1>ğŸŒ· ç¬é–“è‹±ä½œæ–‡ã‚«ãƒ¼ãƒ‰</h1>

  <div class="card-container">
    <div class="card" id="card">
      <!-- è¡¨é¢ -->
      <div class="card-face front">
        <div class="jp" id="jpText"></div>

        <div class="controls">
          <button id="playAudio" class="btn-main">â–¶ å†ç”Ÿ</button>
          <select id="voiceSelect"></select>
          <button id="flipBtn" class="btn-sub">ğŸ’¬ è§£ç­”ã‚’è¦‹ã‚‹</button>
          <button id="rememberBtn" class="btn-main">è¦šãˆãŸğŸ’¡</button>
          <button id="forgetBtn" class="btn-sub">è¦šãˆã¦ã„ãªã„ğŸ™ˆ</button>
          <button id="nextBtn" class="btn-sub">æ¬¡ã®ã‚«ãƒ¼ãƒ‰ â–¶</button>
        </div>
      </div>

      <!-- è£é¢ -->
      <div class="card-face back">
        <div class="en" id="enText"></div>
      </div>
    </div>
  </div>

  <div class="progress" id="progress"></div>
  <footer>âœ¨ Made with love â€” EIMARI âœ¨</footer>

<script>
let cards = [];
let cur = 0;
let learned = JSON.parse(localStorage.getItem('learnedCards') || '{}');
const jpText = document.getElementById('jpText');
const enText = document.getElementById('enText');
const nextBtn = document.getElementById('nextBtn');
const playAudioBtn = document.getElementById('playAudio');
const rememberBtn = document.getElementById('rememberBtn');
const forgetBtn = document.getElementById('forgetBtn');
const flipBtn = document.getElementById('flipBtn');
const progress = document.getElementById('progress');
const card = document.getElementById('card');
const voiceSelect = document.getElementById('voiceSelect');

function updateProgress(){
  const total = cards.length;
  const learnedCount = Object.keys(learned).length;
  progress.textContent = `é€²æ—ï¼š${learnedCount} / ${total} æš`;
}

function saveProgress(){
  localStorage.setItem('learnedCards', JSON.stringify(learned));
  updateProgress();
}

async function loadCards(){
  const res = await fetch('cards.json');
  cards = await res.json();
  showCard();
  updateProgress();
  loadVoices();
}

function showCard(){
  if(cards.length===0) return;
  const c = cards[cur];
  jpText.textContent = c.JP;
  enText.textContent = c.ModelEN;
  card.classList.remove('flip');
}

nextBtn.onclick = ()=>{
  cur = (cur + 1) % cards.length;
  showCard();
};

rememberBtn.onclick = ()=>{
  learned[cards[cur].ModelEN] = true;
  saveProgress();
  nextBtn.click();
};

forgetBtn.onclick = ()=>{
  delete learned[cards[cur].ModelEN];
  saveProgress();
  nextBtn.click();
};

flipBtn.onclick = ()=>{
  card.classList.toggle('flip');
};

// ==== TTS ====
let voices = [];

function loadVoices() {
  voices = speechSynthesis.getVoices().filter(v => v.lang.startsWith('en'));
  if (voices.length === 0) return;
  voiceSelect.innerHTML = voices.map(v => 
    `<option value="${v.name}">${v.name} (${v.lang})</option>`
  ).join('');
}
speechSynthesis.onvoiceschanged = loadVoices;

function speak(text){
  if(!('speechSynthesis' in window)){
    alert('SpeechSynthesisæœªå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã§ã™');
    return;
  }
  const u = new SpeechSynthesisUtterance(text);
  const selectedName = voiceSelect.value;
  const voice = voices.find(v => v.name === selectedName);
  if(voice) u.voice = voice;
  u.rate = 1;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

playAudioBtn.onclick = ()=>{
  const c = cards[cur];
  speak(c.ModelEN);
};

loadCards();
</script>
</body>
</html>
