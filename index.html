<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>🌷 瞬間英作文カード</title>
<style>
  :root {
    --accent: #ff7ca8;
    --bg: #f8f8f8;
    --surface: #fff;
    --shadow: 0 4px 12px rgba(0,0,0,0.08);
    --shadow-hover: 0 8px 20px rgba(0,0,0,0.15);
    --text: #333;
    --muted: #777;
  }
  body {
    margin:0;
    font-family:"Noto Sans JP","Helvetica Neue",sans-serif;
    background:var(--bg);
    color:var(--text);
    display:flex;
    flex-direction:column;
    align-items:center;
    min-height:100vh;
    padding:20px;
  }
  h1 {
    font-weight:600;
    font-size:1.4rem;
    color:var(--accent);
    margin:10px 0 20px;
  }

  /* --- CARD --- */
  .card-container {
    width: 100%;
    max-width: 400px;
    margin-bottom: 20px;
    perspective: 1000px;
  }
  .card {
    width: 100%;
    background: var(--surface);
    border-radius: 16px;
    box-shadow: var(--shadow);
    transition: transform 0.6s;
    transform-style: preserve-3d;
    cursor: pointer;
    position: relative;
  }
  .card.flip { transform: rotateY(180deg); }

  .card-face {
    padding: 30px 20px;
    text-align: center;
    min-height: 220px;
    border-radius: 16px;
    backface-visibility: hidden;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
  }
  .card-face.back {
    position: absolute;
    top: 0;
    left: 0;
    transform: rotateY(180deg);
    width: 100%;
    height: 100%;
    background: var(--surface);
    border-radius: 16px;
    box-shadow: var(--shadow);
  }

  .jp {
    font-size: 20px;
    color: var(--text);
    font-weight:500;
    margin-bottom: 15px;
  }
  .en {
    font-size: 22px;
    color:#444;
  }

  .audio-inside {
    margin-top:auto;
    padding-top:12px;
    border-top:1px solid #eee;
    width:100%;
    display:flex;
    justify-content:center;
  }

  button {
    border:none;
    border-radius:25px;
    padding:10px 18px;
    font-size:15px;
    cursor:pointer;
    transition:.2s ease;
  }
  .btn-main { background:var(--accent); color:#fff; }
  .btn-main:hover { background:#ff6198; }
  .btn-sub { background:#f0f0f0; color:#444; }
  .btn-sub:hover { background:#e4e4e4; }

  .btn-group {
    display:flex;
    justify-content:center;
    gap:10px;
    flex-wrap:wrap;
    margin-bottom:12px;
  }

  .progress {
    margin-top: 10px;
    text-align:center;
    color:#999;
    font-size:14px;
  }
  footer {
    margin-top:25px;
    color: var(--muted);
    font-size:13px;
  }
</style>
</head>
<body>
  <h1>🌷 瞬間英作文カード</h1>

  <div class="card-container">
    <div class="card" id="card">
      <div class="card-face front">
        <div class="jp" id="jpText"></div>
        <div class="audio-inside">
          <button id="playAudio" class="btn-main">▶ 再生</button>
        </div>
      </div>
      <div class="card-face back">
        <div class="en" id="enText"></div>
      </div>
    </div>
  </div>

  <div class="btn-group">
    <button id="rememberBtn" class="btn-main">覚えた💡</button>
    <button id="forgetBtn" class="btn-sub">覚えていない🙈</button>
    <button id="nextBtn" class="btn-sub">次のカード ▶</button>
  </div>

  <div class="progress" id="progress"></div>
  <footer>✨ Made with love — EIMARI ✨</footer>

<script>
let cards = [];
let cur = 0;
let learned = JSON.parse(localStorage.getItem('learnedCards') || '{}');
const jpText = document.getElementById('jpText');
const enText = document.getElementById('enText');
const nextBtn = document.getElementById('nextBtn');
const playAudioBtn = document.getElementById('playAudio');
const rememberBtn = document.getElementById('rememberBtn');
const forgetBtn = document.getElementById('forgetBtn');
const progress = document.getElementById('progress');
const card = document.getElementById('card');

function updateProgress(){
  const total = cards.length;
  const learnedCount = Object.keys(learned).length;
  progress.textContent = `進捗：${learnedCount} / ${total} 枚`;
}

function saveProgress(){
  localStorage.setItem('learnedCards', JSON.stringify(learned));
  updateProgress();
}

async function loadCards(){
  const res = await fetch('cards.json');
  cards = await res.json();
  showCard();
  updateProgress();
}

function showCard(){
  if(cards.length===0) return;
  const c = cards[cur];
  jpText.textContent = c.JP;
  enText.textContent = c.ModelEN;
  card.classList.remove('flip');
}

card.addEventListener('click', (e)=>{
  if(e.target.id === 'playAudio') return;
  card.classList.toggle('flip');
});

nextBtn.onclick = ()=>{
  cur = (cur + 1) % cards.length;
  showCard();
};

rememberBtn.onclick = ()=>{
  learned[cards[cur].ModelEN] = true;
  saveProgress();
  nextBtn.click();
};

forgetBtn.onclick = ()=>{
  delete learned[cards[cur].ModelEN];
  saveProgress();
  nextBtn.click();
};

function speak(text){
  if(!('speechSynthesis' in window)){
    alert('SpeechSynthesis未対応ブラウザです');
    return;
  }
  const u = new SpeechSynthesisUtterance(text);
  const voices = speechSynthesis.getVoices().filter(v => v.lang.startsWith('en'));
  if(voices.length>0) u.voice = voices[0];
  u.rate = 1;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

playAudioBtn.onclick = ()=>{
  const c = cards[cur];
  speak(c.ModelEN);
};

loadCards();
</script>
</body>
</html>
